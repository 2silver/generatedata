{"code":"var context = self;\r\nvar workerUtilsLoaded = false;\r\ncontext.onmessage = function (e) {\r\n    var _a = e.data, workerResources = _a.workerResources, settings = _a.settings, stripWhitespace = _a.stripWhitespace;\r\n    if (!workerUtilsLoaded) {\r\n        importScripts(workerResources.workerUtils);\r\n        workerUtilsLoaded = true;\r\n    }\r\n    var content = settings.dataStructureFormat === 'simple'\r\n        ? generateSimple(e.data, stripWhitespace)\r\n        : generateComplex(e.data, stripWhitespace);\r\n    context.postMessage(content);\r\n};\r\nvar generateSimple = function (generationData, stripWhitespace) {\r\n    var content = '';\r\n    var comma = '';\r\n    var newline = (stripWhitespace) ? '' : '\\n';\r\n    var tab = (stripWhitespace) ? '' : '\\t';\r\n    var space = (stripWhitespace) ? '' : ' ';\r\n    if (generationData.isFirstBatch) {\r\n        content += '[';\r\n    }\r\n    else {\r\n        comma = \",\";\r\n    }\r\n    generationData.rows.forEach(function (row) {\r\n        content += \"\" + comma + newline + tab + \"{\";\r\n        comma = '';\r\n        generationData.columns.forEach(function (_a, colIndex) {\r\n            var title = _a.title, metadata = _a.metadata;\r\n            var propName = title.replace(/\"/, '\"');\r\n            var value = row[colIndex];\r\n            // if a DT has explicitly said it's a string, use a string\r\n            if (metadata && metadata.general && metadata.general.dataType && metadata.general.dataType === 'string') {\r\n                value = \"\\\"\" + value + \"\\\"\";\r\n                // otherwise, do a safety check and encase it in double quote if necessary\r\n            }\r\n            else {\r\n                if (!utils.numberUtils.isNumeric(value) && !isJavascriptBoolean(value)) {\r\n                    value = \"\\\"\" + value + \"\\\"\";\r\n                }\r\n            }\r\n            content += \"\" + comma + newline + tab + tab + \"\\\"\" + propName + \"\\\":\" + space + value;\r\n            comma = ',';\r\n        });\r\n        content += \"\" + newline + tab + \"}\";\r\n    });\r\n    if (generationData.isLastBatch) {\r\n        content += newline + \"]\";\r\n    }\r\n    return content;\r\n};\r\nvar generateComplex = function (generationData, stripWhitespace) {\r\n    var content = '';\r\n    var colTitles = generationData.columns.map(function (_a) {\r\n        var title = _a.title;\r\n        return title;\r\n    });\r\n    if (generationData.isFirstBatch) {\r\n        if (stripWhitespace) {\r\n            var cols = \"\\\"\" + colTitles.join('\",\"') + \"\\\"\";\r\n            content += \"{\\\"cols\\\":[\" + cols + \"],\\\"data\\\":[\";\r\n        }\r\n        else {\r\n            var cols = \"\\\"\" + colTitles.join('\",\\n\\t\\t\"') + \"\\\"\";\r\n            content += \"{\\n\\t\\\"cols\\\": [\\n\\t\\t\" + cols + \"\\n\\t],\\n\\t\\\"data\\\": [\\n\";\r\n        }\r\n    }\r\n    var numRows = generationData.rows.length;\r\n    generationData.rows.forEach(function (row, rowIndex) {\r\n        var rowValsArr = [];\r\n        colTitles.forEach(function (colTitle, colIndex) {\r\n            var value = row[colIndex];\r\n            if (!utils.numberUtils.isNumeric(value) && !isJavascriptBoolean(value)) {\r\n                value = \"\\\"\" + value + \"\\\"\";\r\n            }\r\n            rowValsArr.push(value);\r\n        });\r\n        if (stripWhitespace) {\r\n            var rowVals = rowValsArr.join(',');\r\n            content += \"[\" + rowVals + \"]\";\r\n            if (rowIndex < numRows - 1) {\r\n                content += \",\";\r\n            }\r\n        }\r\n        else {\r\n            var rowVals = rowValsArr.join(',\\n\\t\\t\\t');\r\n            content += \"\\t\\t[\\n\\t\\t\\t\" + rowVals + \"\\n\\t\\t]\";\r\n            if (rowIndex < numRows - 1) {\r\n                content += \",\\n\";\r\n            }\r\n            else if (!generationData.isLastBatch) {\r\n                content += \",\\n\";\r\n            }\r\n        }\r\n    });\r\n    if (generationData.isLastBatch) {\r\n        if (stripWhitespace) {\r\n            content += \"]}\";\r\n        }\r\n        else {\r\n            content += \"\\n\\t]\\n}\";\r\n        }\r\n    }\r\n    return content;\r\n};\r\n// private function determineBooleanFields($template)\r\n// {\r\n// \tforeach ($template as $item) {\r\n// \t$this->booleanFields[] = isset($item[\"columnMetadata\"][\"type\"]) && $item[\"columnMetadata\"][\"type\"] == \"boolean\";\r\n// }\r\n// }\r\n//\r\n// private function isNumeric($index, $value)\r\n// {\r\n// \treturn $this->numericFields[$index] && is_numeric($value);\r\n// }\r\n//\r\n// private function isJavascriptBoolean($index, $value)\r\n// {\r\n// \treturn $this->booleanFields[$index] && ($value === \"true\" || $value === \"false\");\r\n// }\r\n// const determineNumericFields = ($template) => {\r\n// {\r\n//     // foreach ($template as $item){\r\n//     //     $this->numericFields[] = isset($item[\"columnMetadata\"][\"type\"]) && $item[\"columnMetadata\"][\"type\"] == \"numeric\";\r\n//     // }\r\n// }\r\n// const getDownloadFilename = () => {\r\n// \t// $time = date(\"M-j-Y\");\r\n// \t// return \"data{$time}.json\";\r\n// };\r\nvar isJavascriptBoolean = function (n) { return n === 'true' || n === 'false' || n === true || n === false; };\r\nvar isNested = function (columnTitles) { return columnTitles.some(function (i) { return /\\./.test(i); }); };\r\n//# sourceMappingURL=JSON.generator.js.map","references":["/Users/benkeen/generatedata/types/exportTypes.d.ts"],"map":"{\"version\":3,\"file\":\"JSON.generator.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/plugins/exportTypes/JSON/JSON.generator.ts\"],\"names\":[],\"mappings\":\"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\"}"}
